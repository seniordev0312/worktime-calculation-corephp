<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- <link rel="stylesheet" href="style.css" /> -->
  <title>Document</title>
</head>

<body>
  <div class="px-4 sm:px-6 lg:px-8 min-h-[100vh] flex flex-col">
    <h1 class="text-3xl font-bold text-inherit p-10">Time Tracking</h1>
    <div class="mt-8 flow-root">
      <div class="-mx-4 -my-2 overflow-x-auto sm:-mx-6 lg:-mx-8">
        <div class="inline-block min-w-full py-2 align-middle sm:px-6 lg:px-8">
          <div class="overflow-hidden shadow ring-1 ring-black ring-opacity-5 sm:rounded-lg">
            <table class="min-w-full divide-y divide-gray-300">
              <thead class="bg-gray-50">
                <tr class="text-center">
                  <th scope="col" class="py-3.5 pl-4 pr-3 text-sm font-semibold text-gray-900 sm:pl-6">
                    No
                  </th>
                  <th scope="col" class="px-3 py-3.5 text-sm font-semibold text-gray-900">
                    Staff Name
                  </th>
                  <th scope="col" class="px-3 py-3.5 text-sm font-semibold text-gray-900">
                    Start
                  </th>
                  <th scope="col" class="px-3 py-3.5 text-sm font-semibold text-gray-900">
                    Stop
                  </th>
                  <th scope="col" class="px-3 py-3.5 text-sm font-semibold text-gray-900">
                    Request
                  </th>
                  <th scope="col" class="px-3 py-3.5 text-sm font-semibold text-gray-900">
                    Status
                  </th>
                  <th scope="col" class="px-3 py-3.5 text-sm font-semibold text-gray-900">
                    Time Report
                  </th>
                </tr>
              </thead>
              <tbody class="divide-y text-center divide-gray-200 bg-white" id="staff-list">
                <!-- {result_array.map((data, index) => (
                <h1>dddd</h1>
                ))} -->
              </tbody>
            </table>
          </div>
          <div class="flex justify-center mt-5">
            <!-- Previous Button -->
            <button onclick="previous();"
              class="flex items-center justify-center px-4 h-10 mr-3 text-base font-medium text-gray-500 bg-white border border-gray-300 rounded-lg hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">
              <svg class="w-3.5 h-3.5 mr-2" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none"
                viewBox="0 0 14 10">
                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M13 5H1m0 0 4 4M1 5l4-4" />
              </svg>
              Previous
            </button>
            <button onclick="next();"
              class="flex items-center justify-center px-4 h-10 text-base font-medium text-gray-500 bg-white border border-gray-300 rounded-lg hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">
              Next
              <svg class="w-3.5 h-3.5 ml-2" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none"
                viewBox="0 0 14 10">
                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M1 5h12m0 0L9 1m4 4L9 9" />
              </svg>
            </button>
          </div>
          <div id="modal" class="flex justify-center mt-5"></div>
        </div>
      </div>

    </div>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
      integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous">
    </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
</body>

<script type="text/javascript">
  // Initialization for ES Users

let pagination_index = 0;
let result_array = [];
let status_array = [];
let status_stop_array = [];
let selected_row = 0;

function displayContent() {
  const resultContainer = document.getElementById('staff-list');

  const htmlContent = result_array.slice(pagination_index * 5, (pagination_index + 1) * 5).map((item, index) => `
      <tr>
      <td class="whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-gray-900 sm:pl-6">
        ${pagination_index * 5 + 1 + index}
      </td>
      <td class="whitespace-nowrap px-3 py-4 text-sm font-semibold w-[20%]">
        ${item.NAME_FIRST + " " + item.NAME_LAST }
        
      </td>
      <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">`+  `
        <button
          type="button"
          onclick="openPinModal(${item.SID})"
          ${status_array[pagination_index * 5 + index] ? 'disabled' : ''}
          class="rounded-md disabled:opacity-25 bg-slate-50 px-10 py-2.5 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-200"
        >
          Start
        </button>
      </td>
      <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">
        <button
          type="button"
          onclick="stopPinModal(${item.SID})"
          ${!status_stop_array[pagination_index * 5 + index] ? 'disabled' : ''}
          class="rounded-md disabled:opacity-25 bg-red-200 px-10 py-2.5 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-red-300"
        >
          Stop
        </button>
      </td>
      <td class="relative whitespace-nowrap py-4 text-sm font-medium ">
        <button
          type="button"
          onclick="openRequestModal()"
          class="rounded-md bg-slate-100 px-10 py-2.5 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50"
        >
          Request
        </button>
      </td>
      <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">
        <div class="flex items-center h-5 justify-center">
          <input
            id="helper-radio"
            aria-describedby="helper-radio-text"
            type="radio"
            ${status_array[pagination_index * 5 + index] ? 'disabled' : ''}
            ${!status_array[pagination_index * 5 + index]? 'checked': ''}
            class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"
          />
        </div>
      </td>
      <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">
        <button
          type="button"
          class="rounded-md disabled:opacity-25 bg-slate-50 px-10 py-2.5 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-200"
        >
          TimeTrack
        </button>
      </td>
    </tr>
      `).join('');
  resultContainer.innerHTML = htmlContent;
}

function getInitialContent() {
  $.ajax({
    type: "GET",
    url: 'get_staff_data.php',
    success: function(response) {
      // var jsonData = JSON.parse(response);
      let i = 0;
      let indexStart;
      let indexEnd;
      while (i < response.length) {
        if (response[i] == '{') {
          indexStart = i;
        }
        if (response[i] == '}') {
          indexEnd = i;
          const text = JSON.parse(response.slice(indexStart, indexEnd + 1));
          result_array.push(text);
        }
        i++;
      }
      console.log(result_array[0].status);
      let sids = [];
      for(let i = 0; i < result_array.length; i++) {
        sids.push(result_array[i].SID);
      }

      $.ajax({
        url: "get_disabled_status.php",
        type: "GET", //send it through get method
        data: { 
          sid: sids, 
        },
        success: function(response) {
          let response_array = response.split(',');
          response_array.pop();
          for(let i = 0; i < response_array.length; i++) {
            if(response_array[i] === '0') {
              status_array.push(false);
            } else if(response_array[i] === '1') {
              status_array.push(true);
            }
          }
          // $.ajax({
          //   url: "get_stop_disabled_status.php",
          //   type: "GET", //send it through get method
          //   data: { 
          //     sid: sids, 
          //   },
          //   success: function(response) {
          //     let response_array = response.split(',');
          //     response_array.pop();
          //     for(let i = 0; i < response_array.length; i++) {
          //       if(response_array[i] === '0') {
          //         status_stop_array.push(false);
          //       } else if(response_array[i] === '1') {
          //         status_stop_array.push(true);
          //       }
          //     }
          //     console.log('status stop array', status_stop_array);
          //     //Do Something
          //     displayContent();

          //   },
          //   error: function(xhr) {
          //     //Do Something to handle error
          //   }
          // });

          //Do Something
          displayContent();
        },
        error: function(xhr) {
          //Do Something to handle error
        }
      });

      console.log(result_array[0].status);


      // console.log(result_array);
    }
  });
}

$(document).ready(function() {
  getInitialContent();
 
})

function previous() {
  if (pagination_index > 0) pagination_index--;
  displayContent();
}

function next() {
  if (pagination_index < result_array.length) pagination_index++;
  displayContent();
}

function openPinModal(sid) {
  const container = document.getElementById("modal");
  const htmlContent = `<div class="relative w-full max-w-md] max-h-full">
  <div class="relative bg-white rounded-lg shadow min-h-[80% dark:bg-gray-700">
    <button
      type="button"
      onclick="closePinModal()"
      class="absolute top-3 right-2.5 text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ml-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white"
      data-modal-hide="authentication-modal"
    >
      <svg
        class="w-3 h-3"
        aria-hidden="true"
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 14 14"
      >
        <path
          stroke="currentColor"
          strokeLinecap="round"
          strokeLinejoin="round"
          strokeWidth="2"
          d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"
        />
      </svg>
      <span class="sr-only">Close modal</span>
    </button>
    <div class="px-6 py-6 lg:px-8 flex flex-col gap-4">
      <h3 class="mb-4 text-xl font-medium text-gray-900 dark:text-white">
        Start the time track
      </h3>
      <div>
        <label
          htmlFor="password"
          class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
        >
          PIN
        </label>
        <input
          type="password"
          name="password"
          id="password"
          placeholder="••••"
          class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white"
          required
        />
      </div>

      <button
        type="submit"
        onclick="submitPasscode(${sid})"
        class="w-full text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"
      >
        Please start the time tracking with the PIN
      </button>
    </div>
  </div>
</div>
  `;
  container.innerHTML = htmlContent;

  
}

function submitPasscode(id) {
  const passcode = document.getElementById("password").value;
  // const id = id;
  const data = {
    passcode, id
  };

  $.ajax({
    type: "POST",
    url: 'match_passcode.php',
    data: data,
    success: function(response) {

      const create_data = {
        id
      }
      if(response == "1") {
        $.ajax({
          type: "POST",
          url: 'start_timetrack.php',
          data: create_data,
          success: function(response) {
            alert("time track successfuly started");
            location.reload();
          },
        });
      } else {
        alert("passcode does not match");
      }
    },
  });
}

function stopPinModal(stop_id) {

  const htmlContent = `<div class="relative w-full max-w-md max-h-full">
      <div class="relative bg-white rounded-lg shadow dark:bg-gray-700">
        <button
          type="button"
          onclick="closeStopModal()"
          class="absolute top-3 right-2.5 text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ml-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white"
          data-modal-hide="popup-modal"
        >
          <svg
            class="w-3 h-3"
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 14 14"
          >
            <path
              stroke="currentColor"
              strokeLinecap="round"
              strokeLinejoin="round"
              strokeWidth="2"
              d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"
            />
          </svg>
          <span class="sr-only">Close modal</span>
        </button>
        <div class="p-6 text-center">
          <svg
            class="mx-auto mb-4 text-gray-400 w-12 h-12 dark:text-gray-200"
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 20 20"
          >
            <path
              stroke="currentColor"
              strokeLinecap="round"
              strokeLinejoin="round"
              strokeWidth="2"
              d="M10 11V6m0 8h.01M19 10a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"
            />
          </svg>
          <h3 class="mb-5 text-lg font-normal text-gray-500 dark:text-gray-400">
            Are you sure you want to pause the time track?
          </h3>
          <button
            data-modal-hide="popup-modal"
            type="button"
            onclick="closeTimetrack(${stop_id})"
            class="text-white bg-red-600 hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-red-300 dark:focus:ring-red-800 font-medium rounded-lg text-sm inline-flex items-center px-5 py-2.5 text-center mr-2"
          >
            Yes, I'm sure
          </button>
          <button
            data-modal-hide="popup-modal"
            type="button"
            onclick="closePinModal()"
            class="text-gray-500 bg-white hover:bg-gray-100 focus:ring-4 focus:outline-none focus:ring-gray-200 rounded-lg border border-gray-200 text-sm font-medium px-5 py-2.5 hover:text-gray-900 focus:z-10 dark:bg-gray-700 dark:text-gray-300 dark:border-gray-500 dark:hover:text-white dark:hover:bg-gray-600 dark:focus:ring-gray-600"
          >
            No, cancel
          </button>
        </div>
      </div>
    </div>`

  document.getElementById("modal").innerHTML = htmlContent;
  
}

function closeStopModal() {
  document.getElementById("modal").innerHTML = '';
}

function openRequestModal() {

  const htmlContent = `
  
<div class="relative w-full max-w-md] max-h-full">
  <div class="relative bg-white rounded-lg shadow min-h-[80% dark:bg-gray-700">
    <button
      type="button"
      class="absolute top-3 right-2.5 text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ml-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white"
      data-modal-hide="authentication-modal"
    >
      <svg
        class="w-3 h-3"
        aria-hidden="true"
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 14 14"
      >
        <path
          stroke="currentColor"
          strokeLinecap="round"
          strokeLinejoin="round"
          strokeWidth="2"
          d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"
        />
      </svg>
      <span class="sr-only">Close modal</span>
    </button>
    <div class="px-6 py-6 lg:px-8">
      <h3 class="mb-4 text-xl font-medium text-gray-900 dark:text-white">
        Request more times to log
      </h3>
      <form class="space-y-6" action="#">
        <div class="flex flex-row gap-10">
          <input
            type="text"
            name="text"
            id="text"
            placeholder="Name"
            class="bg-gray-50 flex-1 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white"
            required
          />
          <input
            type="text"
            name="text"
            id="texxt"
            placeholder="Surname"
            class="bg-gray-50 border flex-1 border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white"
            required
          />
        </div>
        <div class="flex flex-row gap-10">
          <div class="flex-1">
            <div
              class="relative"
              data-te-datepicker-init
              data-te-format="dd, mmm, yyyy"
              data-te-input-wrapper-init>
              <input
                type="text"
                class="peer block min-h-[auto] bg-gray-50 w-full leading-[1.6] outline-none transition-all duration-200 ease-linear focus:placeholder:opacity-50 peer-focus:text-primary data-[te-input-state-active]:placeholder:opacity-100 motion-reduce:transition-none dark:text-neutral-200 dark:placeholder:text-neutral-200 dark:peer-focus:text-primary [&:not([data-te-input-placeholder-active])]:placeholder:opacity-0 bg-gray-50 border flex-1 border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white"
                placeholder="Select a date" />
              <label
                for="floatingInput"
                class="pointer-events-none absolute left-3 top-0 mb-0 max-w-[90%] origin-[0_0] focus:placeholder:opacity-50 truncate pt-[0.37rem] leading-[1.6] text-neutral-500 transition-all duration-200 ease-out peer-focus:-translate-y-[0.9rem] peer-focus:scale-[0.8] peer-focus:text-primary peer-data-[te-input-state-active]:-translate-y-[0.9rem] peer-data-[te-input-state-active]:scale-[0.8] motion-reduce:transition-none dark:text-neutral-200 dark:peer-focus:text-primary"
                >Select a date</label
              >
            </div>
          </div>
          <input
            type="text"
            name="text"
            id="hour"
            placeholder="Hours"
            class="bg-gray-50 border focus:placeholder:opacity-50 flex-1 border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full px-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white"
            required
          />

        </div>

        <button
          type="submit"
          class="w-full text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"
        >
          Submit the request to admin
        </button>
      </form>
    </div>
  </div>
</div>
  `

  document.getElementById("modal").innerHTML = htmlContent;
}

function closePinModal() {
  document.getElementById("modal").innerHTML = '';
}

function closeTimetrack(stopped_id) {
  const data = {
    id: stopped_id
  };
  $.ajax({
    type: "POST",
    url: 'close_timetrack.php',
    data: data,
    success: function(response) {
      console.log(response)
      alert("successfully stopped");
      location.reload();
    }
  });
}

</script>



</html>

